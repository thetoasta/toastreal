<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenAI Interaction</title>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css?family=Google+Sans&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <!-- GenAI Script -->
    <script type="module">
        import { helloFlow } from './genai.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAIi3_sc81JogKi_UjMGYqUMvsf4WBDJPc",
            authDomain: "toastrealxyz.firebaseapp.com",
            projectId: "toastrealxyz",
            storageBucket: "toastrealxyz.appspot.com",
            messagingSenderId: "774884910313",
            appId: "1:774884910313:web:e11002887adf1055acfc78",
            measurementId: "G-3H38LZB2BX"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Check if user is logged in
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                document.getElementById('logout-button').style.display = 'block';
            } else {
                document.getElementById('logout-button').style.display = 'none';
            }
        });

        // Log out user
        function logout() {
            firebase.auth().signOut().then(() => {
                window.location.href = 'accounts.html';
            }).catch((error) => {
                showNotification('Error: ' + error.message, 'error');
            });
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerText = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Interact with GenAI
        async function interactWithGenAI(event) {
            event.preventDefault();
            const name = document.getElementById('name-input').value;
            try {
                const { text } = await helloFlow(name);
                document.getElementById('response').innerText = text;
            } catch (error) {
                showNotification('Error: ' + error.message, 'error');
            }
        }

        window.interactWithGenAI = interactWithGenAI;
        window.logout = logout;
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1><strong>GenAI Interaction</strong></h1>
            <button id="logout-button" onclick="logout()" style="display: none;">Logout</button>
        </header>
        <div class="form-container">
            <form onsubmit="interactWithGenAI(event)">
                <input type="text" id="name-input" placeholder="What's up?" required><br>
                <button type="submit">Send</button>
            </form>
        </div>
        <div id="response-container">
            <h2>Response:</h2>
            <p id="response"></p>
        </div>
    </div>
</body>
</html>